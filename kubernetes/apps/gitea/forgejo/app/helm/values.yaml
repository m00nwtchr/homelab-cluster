---
ingress:
  enabled: true
  hosts:
    - host: git.${SECRET_DOMAIN}
      paths:
        - path: /
          pathType: Prefix

image:
  rootless: true
  registry: code.forgejo.org
  repository: forgejo/forgejo
  tag: 11.0.1-rootless
  digest: sha256:97b544c9bf4ff13c034a6a8319feffe822ff4f5f73d5bd03dbca3fdeaae0c2ac

gitea:
#  admin:
#    existingSecret: gitea-admin-secret
#    email: { { .Values.email } }

  oauth:
    - name: kanidm
      provider: openidConnect
      key: gitea
      existingSecret: forgejo-oidc
      autoDiscoverUrl: "https://idm.${SECRET_DOMAIN}/oauth2/openid/gitea/.well-known/openid-configuration"

  config:
    database:
      DB_TYPE: mysql
      HOST: mariadb.mariadb.svc:3306
    server:
      APP_DATA_PATH: /data/gitea
      ROOT_URL: https://git.${SECRET_DOMAIN}
      START_SSH_SERVER: false
    lfs:
      PATH: /data/git/lfs
    repository:
      ROOT: /data/git/repositories
    indexer:
      ISSUE_INDEXER_TYPE: bleve
      REPO_INDEXER_ENABLED: true
    openid:
      ENABLE_OPENID_SIGNIN: false
      ENABLE_OPENID_SIGNUP: true
      WHITELISTED_URIS: "idm.${SECRET_DOMAIN}"
    service:
      ALLOW_ONLY_EXTERNAL_REGISTRATION: true
      SHOW_REGISTRATION_BUTTON: false
      ENABLE_PASSWORD_SIGNIN_FORM: false
    queue:
      TYPE: redis
      CONN_STR: redis://dragonfly.database.svc:6379/0?pool_size=100&idle_timeout=180s
    session:
      PROVIDER: redis
      PROVIDER_CONFIG: redis://dragonfly.database.svc:6379/0?pool_size=100&idle_timeout=180s
    cache:
      ENABLED: true
      ADAPTER: redis
      HOST: redis://dragonfly.database.svc:6379/0?pool_size=100&idle_timeout=180s

additionalConfigFromEnvs:
  - name: GITEA__DATABASE__PASSWD
    valueFrom:
      secretKeyRef:
        name: gitea-db-user
        key: mariadb-password

service:
  ssh:
    clusterIP: 2001:cafe:43::ef37

redis-cluster:
  enabled: false
postgresql-ha:
  enabled: false

persistence:
  enabled: true

extraVolumes:
  - name: git
    persistentVolumeClaim:
      claimName: git
extraContainerVolumeMounts:
  - name: git
    mountPath: "/data/git/"
