---
# yaml-language-server: $schema=https://kubernetes-schemas.pages.dev/source.toolkit.fluxcd.io/ocirepository_v1.json
apiVersion: source.toolkit.fluxcd.io/v1
kind: OCIRepository
metadata:
  name: kube-guardian
spec:
  interval: 5m
  layerSelector:
    mediaType: application/vnd.cncf.helm.chart.content.v1.tar+gzip
    operation: copy
  ref:
    tag: 0.0.33
  url: oci://ghcr.io/xentra-ai/charts/kube-guardian
---
# yaml-language-server: $schema=https://raw.githubusercontent.com/fluxcd-community/flux2-schemas/main/helmrelease-helm-v2.json
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: kube-guardian
spec:
  interval: 1h
  chartRef:
    kind: OCIRepository
    name: kube-guardian
  install:
    remediation:
      retries: -1
  upgrade:
    cleanupOnFail: true
    remediation:
      retries: 3
  values:
    controller:
      image:
        repository: ghcr.io/xentra-ai/images/guardian-controller
        tag: "v0.0.19@sha256:54816f077c9d840c9d75376a0a4636ae41d8d37f131c7f4496be02980b20e62b"
        pullPolicy: IfNotPresent
      initContainer:
        image:
          repository: busybox
          tag: "1.37.0-musl@sha256:597bf7e5e8faf26b8efc4cb558eea5dc14d9cc97d5b4c8cdbe6404a7432d5a67"
          pullPolicy: IfNotPresent
    broker:
      image:
        repository: ghcr.io/xentra-ai/images/guardian-broker
        tag: "v0.0.19@sha256:a72f0b3b22d07c160319639f2f9c84cb487eacf8771ad1b6be4fd323793452a0"
        pullPolicy: IfNotPresent

    database:
      image:
        repository: postgres
        tag: "17.6-alpine@sha256:3406990b6e4c7192317b6fdc5680498744f6142f01f0287f4ee0420d8c74063c"
        pullPolicy: IfNotPresent
