---
# yaml-language-server: $schema=https://json.schemastore.org/kustomization
apiVersion: kustomize.config.k8s.io/v1alpha1
kind: Component
patches:
  - target:
      kind: HelmRelease
      version: v2
    patch: |-
      - op: add
        path: /spec/interval
        value: 1h
      - op: add
        path: /spec/install
        value:
          crds: CreateReplace
          remediation:
            retries: -1
      - op: add
        path: /spec/upgrade
        value:
          cleanupOnFail: true
          crds: CreateReplace
          remediation:
            retries: 3
      - op: add
        path: /spec/driftDetection
        value:
          mode: enabled
          ignore:
            - paths: ["/spec/replicas"]
              target:
                kind: Deployment
            - paths: ["/spec/replicas"]
              target:
                kind: StatefulSet
            - paths: ["/metadata/annotations/prometheus-operator-validated"]
              target:
                kind: PrometheusRule
            - paths: ["/metadata/annotations/prometheus-operator-validated"]
              target:
                kind: ServiceMonitor
