---
apiVersion: v1
kind: ConfigMap
metadata:
  name: kanidm-${APP}-oidc
  namespace: kanidm
  labels:
    kanidm_config: "1"
data:
  targetNamespace: "${NAMESPACE}"
  state.json: |
    {
      "systems": {
        "oauth2": {
          "${APP}": {
            "displayName": "${DISPLAY_NAME}",
            "originUrl": ["https://${SUBDOMAIN}.${SECRET_DOMAIN}${CALLBACK}"],
            "originLanding": "https://${SUBDOMAIN}.${SECRET_DOMAIN}${ORIGIN}",
            "removeOrphanedClaimMaps": true,
            "public": ${PUBLIC},
            "preferShortUsername": ${SHORT_USERNAME},
            "enableLocalhostRedirects": ${LOCALHOST},
            "enableLegacyCrypto": ${LEGACY_CRYPTO},
            "allowInsecureClientDisablePkce": ${DISABLE_PKCE},
            "scopeMaps": ${SCOPE_MAPS:=${emptyState}},
            "supplementaryScopeMaps": ${SUP_SCOPE_MAPS:=${emptyState}},
            "claimMaps": ${CLAIM_MAPS:=${emptyState}}
          }
        }
      }
    }
  extra.json: |
    {
      "systems": {
        "oauth2": {
          "${APP}": {
            "originUrl": ${EXTRA_CALLBACKS:=${emptyArray}}
          }
        }
      }
    }
  custom.json: |
    {
      "systems": {
        "oauth2": {
          "${APP}": ${CUSTOM_STATE:=${emptyState}}
        }
      }
    }
