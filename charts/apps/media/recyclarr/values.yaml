app-template:
  controllers:
    recyclarr:
      type: cronjob

      cronjob:
        schedule: "@daily"
        backoffLimit: 0
        concurrencyPolicy: Forbid
        failedJobsHistory: 1
        successfulJobsHistory: 0

      pod:
        securityContext:
          runAsUser: 2000
          runAsGroup: 2000
          runAsNonRoot: true
          fsGroup: 2000
          fsGroupChangePolicy: OnRootMismatch

      containers:
        app:
          image:
            repository: ghcr.io/recyclarr/recyclarr
            tag: 7.4.1@sha256:759540877f95453eca8a26c1a93593e783a7a824c324fbd57523deffb67f48e1
          args:
            - sync
          env:
            SONARR_API_KEY:
              valueFrom:
                secretKeyRef:
                  name: sonarr-secret
                  key: api_key
            RADARR_API_KEY:
              valueFrom:
                secretKeyRef:
                  name: radarr-secret
                  key: api_key
          resources:
            requests:
              cpu: 5m
              memory: 36M
            limits:
              memory: 128M
          securityContext:
            allowPrivilegeEscalation: true
            readOnlyRootFilesystem: true
            capabilities:
              drop:
                - ALL

  persistence:
    config:
      size: 1Gi
      accessMode: ReadWriteOnce
      annotations:
        argocd.argoproj.io/sync-options: Delete=falses
      advancedMounts:
        recyclarr:
          app:
            - path: /config
    config-file:
      type: configMap
      name: recyclarr
      globalMounts:
        - path: /config/recyclarr.yml
          subPath: recyclarr.yml
          readOnly: true
