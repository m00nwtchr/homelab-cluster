---
# yaml-language-server: $schema=https://raw.githubusercontent.com/bjw-s/helm-charts/app-template-3.2.0/charts/other/app-template/values.schema.json

app-template:
  controllers:
    unbound:
      strategy: RollingUpdate
      rollingUpdate:
        maxUnavailable: 0
        maxSurge: 25%
      pod:
        dnsConfig:
          options:
            - { name: ndots, value: "1" }
        securityContext:
          runAsNonRoot: true
          runAsUser: 65534
          runAsGroup: 65534
          fsGroup: 65534
          fsGroupChangePolicy: OnRootMismatch
          seccompProfile: { type: RuntimeDefault }
      containers:
        app:
          image:
            repository: ghcr.io/handshake-org/hsd
            tag: 7.0.1@sha256:6469b57eb95537e6da39dcd6d2d40094e283b9a638e79115e3cbab2581eb6821
          args:
            - --no-wallet
            - --spv
          env:
            HSD_RS_HOST: "::"
            HSD_RS_PORT: &dns-port 5350
          ports:
            - containerPort: *dns-port
          probes:
            liveness: &probes
              enabled: true
              custom: false
              type: TCP
            readiness: *probes
          resources:
            requests:
              cpu: 10m
              memory: 256M
            limits:
              memory: 512M

  service:
    app:
      controller: unbound
      clusterIP: 2001:cafe:43::f497
      ports:
        dns-tcp:
          enabled: true
          port: 53
          protocol: TCP
          targetPort: *dns-port
        dns-udp:
          enabled: true
          port: 53
          protocol: UDP
          targetPort: *dns-port

#  persistence:
#    config:
#      type: configMap
#      name: unbound-config
#      defaultMode: 0755
#      globalMounts:
#        - path: /config
#        - path: /unbound.sh
#          subPath: unbound.sh
#    tmp:
#      type: emptyDir
#      globalMounts:
#        - path: /var/lib/unbound/
#          subPath: var
#        - path: /etc/unbound
#          subPath: etc