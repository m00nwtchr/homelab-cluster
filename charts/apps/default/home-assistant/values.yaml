app-template:
  controllers:
    home-assistant:
      annotations:
        reloader.stakater.com/auto: "true"
      containers:
        app:
          image:
            repository: ghcr.io/onedr0p/home-assistant
            tag: 2025.2.5@sha256:3ffef764606b1eb13bb9d4e902b23859ae192a00196e2f275fb5d2b845b520d5
          env:
            TZ: Europe/Warsaw
            HOME_ASSISTANT__HACS_INSTALL: "true"
          envFrom:
            - secretRef:
                name: home-assistant-secret
          securityContext:
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            capabilities: { drop: [ "ALL" ] }
          resources:
            requests:
              cpu: 10m
            limits:
              memory: 2Gi
  #        code-server:
  #          image:
  #            repository: ghcr.io/coder/code-server
  #            tag: 4.96.4@sha256:f93810f7f6636b3af3b1a750faf612349cddb89fbb6d28d69123a214fc75ee9e
  #          args: [
  #            "--auth", "none",
  #            "--user-data-dir", "/config/.vscode",
  #            "--extensions-dir", "/config/.vscode",
  #            "--port", "12321",
  #            "/config"
  #          ]
  #          resources:
  #            requests:
  #              cpu: 10m
  #            limits:
  #              memory: 512Mi
  defaultPodOptions:
    securityContext:
      runAsNonRoot: true
      runAsUser: 1000
      runAsGroup: 1000
      fsGroup: 1000
      fsGroupChangePolicy: OnRootMismatch
  service:
    app:
      controller: home-assistant
      ports:
        http:
          port: 8123
  #        code-server:
  #          port: 12321
  ingress:
    app:
      hosts:
        - host: hass.m00nlit.dev
          paths:
            - path: /
              service:
                identifier: app
                port: http
        - host: hass.svc.m00nlit.dev
          paths:
            - path: /
              service:
                identifier: app
                port: http
  #    code-server:
  #      className: internal
  #      hosts:
  #        - host: hass-code.devbu.io
  #          paths:
  #            - path: /
  #              service:
  #                identifier: app
  #                port: code-server
  persistence:
    config:
      size: 1Gi
      accessMode: ReadWriteOnce
      annotations:
        argocd.argoproj.io/sync-options: Delete=false
      globalMounts:
        - path: /config
    config-cache:
      size: 1Gi
      accessMode: ReadWriteOnce
      globalMounts:
        - path: /config/.venv
    config-logs:
      type: emptyDir
      globalMounts:
        - path: /config/logs
    config-tts:
      type: emptyDir
      globalMounts:
        - path: /config/tts
    tmp:
      type: emptyDir
      globalMounts:
        - path: /tmp