app-template:
  controllers:
    baikal:
      pod:
        securityContext:
          runAsUser: 101
          runAsGroup: 101
          runAsNonRoot: true
          fsGroup: 101
          fsGroupChangePolicy: OnRootMismatch

      initContainers:
        copy-config:
          image: busybox
          command: [ "/bin/sh", "-c", "cp /config/baikal.yaml /mnt/ && chown 101:101 /mnt/baikal.yaml" ]

      containers:
        nginx:
          image:
            repository: ckulka/baikal
            tag: 0.10.1-nginx
          env:
            - name: BAIKAL_SKIP_CHOWN
              value: "true"
        php:
          image:
            repository: ckulka/baikal
            tag: 0.10.1-nginx
          command: [ "/bin/sh", "-c", 'find /usr/sbin/ -type f -name "php-fpm*" -exec "{}" "-F" \;' ]
          # securityContext:


  service:
    app:
      controller: baikal
      ports:
        http:
          port: 80
          targetPort: 8080
  ingress:
    app:
      hosts:
        - host: baikal.m00nlit.dev
          paths:
            - path: /
              service:
                identifier: app
                port: http
        - host: baikal.svc.m00nlit.dev
          paths:
            - path: /
              service:
                identifier: app
                port: http
  persistence:
    config:
      type: secret
      name: baikal-config
      defaultMode: 0660
      advancedMounts:
        baikal:
          copy-config:
            - path: /config/baikal.yaml
              subPath: baikal.yaml

    nginx-config:
      type: configMap
      name: baikal-nginx-config
      advancedMounts:
        baikal:
          nginx:
            - path: /etc/nginx/conf.d/default.conf
              subPath: nginx.conf
    cache:
      type: emptyDir
      globalMounts:
        - path: /var/run/
          subPath: run/
        - path: /var/log/
          subPath: log/
      advancedMounts:
        baikal:
          nginx:
            - path: /var/cache/nginx/
              subPath: nginx/
            - path: /var/log/nginx/
              subPath: log/nginx/
          php:
            - path: /run/php/
              subPath: run/php/
            - path: /var/www/baikal/config/
              subPath: config/
          copy-config:
            - path: /mnt
              subPath: config
#    data:
#      size: 1Gi
#      accessMode: ReadWriteOnce
#      annotations:
#        argocd.argoproj.io/sync-options: Delete=false
#      globalMounts:
#        - path: /var/www/baikal/Specific