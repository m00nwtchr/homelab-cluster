app-template:
  defaultPodOptions:
    enableServiceLinks: false
    securityContext:
      runAsUser: 568
      runAsGroup: 568
      runAsNonRoot: true
      fsGroup: 1000
      fsGroupChangePolicy: "OnRootMismatch"
#      supplementalGroups: [160, 140, 241, 0, 10, 121]

  controllers:
    webserver:
      strategy: Recreate
      containers:
        main:
          image:
            repository: ghcr.io/nginxinc/nginx-unprivileged
            tag: 1.27.4@sha256:2ab8a5f2333e28ddb38819b0eb86fb71b959f5a481cec62cef574570f2d8c573
          ports:
            - containerPort: 8080

  service:
    app:
      controller: webserver
      ports:
        http:
          port: 80
          targetPort: 8080

  ingress:
    main:
      annotations:
        traefik.ingress.kubernetes.io/router.tls.options: traefik-intermediate@kubernetescrd
      hosts:
        - host: m00nlit.dev
          paths:
            - path: /.well-known/openpgpkey/
              service:
                identifier: app
                port: http

  persistence:
    config:
      type: configMap
      name: nginx-config # referenced ConfigMap name
      globalMounts:
        - path: /etc/nginx/nginx.conf
          subPath: nginx.conf  # Ensure this matches the key name in the ConfigMap
          readOnly: true
    openpgpkey:
      type: configMap
      name: nginx-openpgpkey
      globalMounts:
        - path: /var/www/html/openpgpkey/
          readOnly: true
    var:
      type: emptyDir
      globalMounts:
        - path: /var/log/nginx
          subPath: nginx
        - path: /var/cache/nginx
          subPath: nginx
        - path: /var/run
          subPath: run