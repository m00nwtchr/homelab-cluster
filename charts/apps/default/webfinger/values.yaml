app-template:
  controllers:
    gofinger:
      pod:
        securityContext:
          runAsNonRoot: true
          fsGroupChangePolicy: "OnRootMismatch"

      containers:
        app:
          image:
            repository: ghcr.io/artemstepanov/go-finger
            tag: main@sha256:2144c840191f28cd894f231e99d7bc97df254bd59e8bbce9494040bfe4e68f77
          resources:
            requests:
              memory: 2Mi
            limits:
              memory: 64Mi
          securityContext:
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            capabilities:
              drop:
                - ALL

  service:
    app:
      controller: gofinger
      ports:
        http:
          targetPort: 8080
          port: 80

  ingress:
    app:
      annotations:
        traefik.ingress.kubernetes.io/tls.options: traefik-intermediate@kubernetescrd
      hosts:
        - host: m00nlit.dev
          paths:
            - path: /.well-known/webfinger
              service:
                identifier: app
                port: http

  persistence:
    config:
      enabled: true
      type: configMap
      name: webfinger-config
      globalMounts:
        - path: /app/fingers.yml
          subPath: fingers.yaml

  configMaps:
    config:
      data:
        fingers.yaml: |
          m00n@m00nlit.dev:
            openid: "https://idm.m00nlit.dev/oauth2/openid/tailscale"
