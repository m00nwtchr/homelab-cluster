---
# yaml-language-server: $schema=https://raw.githubusercontent.com/bjw-s/helm-charts/app-template-3.2.0/charts/other/app-template/values.schema.json

app-template:
  controllers:
    main:
      annotations:
        reloader.stakater.com/auto: "true"

      containers:
        app:
          image:
            repository: ghcr.io/stalwartlabs/stalwart
            tag: v0.12.4@sha256:705fdac38a54cfae167e2b8edc68117df0a3d42b679a26615e1e60c3cddb4d77
          probes:
            liveness:
              enabled: true
              custom: true
              spec:
                httpGet:
                  path: /healthz/live
                  port: 8080
                initialDelaySeconds: 30
                periodSeconds: 10
            readiness:
              enabled: true
              custom: true
              spec:
                httpGet:
                  path: /healthz/ready
                  port: 8080
                initialDelaySeconds: 5
                periodSeconds: 10
#          resources:
#            limits:
#              memory: 1.2Gi
#            requests:
#              cpu: 40m
#              memory: 1.2Gi

  service:
    app:
      controller: main
      type: NodePort
      ports:
        http:
          port: 80
          targetPort: 8080
        smtp:
          port: 25
          nodePort: 30025
#          targetPort: 25
        submission:
          port: 587
#          targetPort: 587
        imap:
          port: 143
#          targetPort: 143
        sieve:
          port: 4190
#          targetPort: 4190

  ingress:
    app:
#      annotations:
#        gethomepage.dev/enabled: "true"
#        gethomepage.dev/group: Home
#        gethomepage.dev/name: Paperless
#        gethomepage.dev/icon: paperless.svg
      hosts:
        - host: mail.m00nlit.dev
          paths:
            - path: /
              service:
                identifier: app
                port: http

  persistence:
    config:
      type: secret
      name: stalwart
      globalMounts:
        - path: /opt/stalwart/etc/config.toml
          subPath: config.toml
    data:
      size: 1Gi
      accessMode: ReadWriteOnce
      globalMounts:
        - path: /var/lib/data/blobs