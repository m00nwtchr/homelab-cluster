app-template:
  defaultPodOptions:
    enableServiceLinks: false
    securityContext:
      runAsUser: 568
      runAsGroup: 568
      runAsNonRoot: true
      fsGroup: 1000
      fsGroupChangePolicy: "OnRootMismatch"
#      supplementalGroups: [160, 140, 241, 0, 10, 121]

  controllers:
    wks:
      strategy: Recreate
      containers:
        main:
          image:
            repository: ghcr.io/m00nwtchr/runemail-wks
            tag: master@sha256:92db3664363f50cc228de444856e7e1e3dd4867cfcba52a89fe97527b7940260
          ports:
            - containerPort: 3434

  service:
    app:
      controller: wks
      ports:
        http:
          port: 80
          targetPort: 3434

  ingress:
    main:
      annotations:
        traefik.ingress.kubernetes.io/router.tls.options: traefik-intermediate@kubernetescrd
      hosts:
        - host: m00nlit.dev
          paths:
            - path: /.well-known/openpgpkey/
              service:
                identifier: app
                port: http

  persistence:
    keys:
      type: configMap
      name: wks-keys
      globalMounts:
        - path: /keys/
          readOnly: true