app-template:
  controllers:
    valkey:
      containers:
        app:
          image:
            repository: docker.io/valkey/valkey
            tag: 8.1.1-alpine@sha256:f43639a6811342b5db26475f3463d4d1950d07bf05542d9483159a44be1fe62f

    rssflow:
      containers:
        app:
          image:
            repository: ghcr.io/m00nwtchr/rssflow
            tag: master@sha256:962e29b8f38e655fb980e28af1b74d8f3f24a35b461e63480fb9d61e284a558e
          env:
            RUST_LOG: "info"
            REDIS_URL: redis://rssflow-valkey
          envFrom:
            - secretRef:
                name: rssflow-env
          resources:
            requests:
              cpu: 50m
              memory: 256Mi

    websub:
      containers:
        app: &controller
          image:
            repository: ghcr.io/m00nwtchr/rssflow-websub
            tag: master@sha256:5a14c1053454b407a355608951389238f2741349b2bf56a750bddc80ccb3e5ae
          env:
            RUST_LOG: "info"
            REDIS_URL: redis://rssflow-valkey
          envFrom:
            - secretRef:
                name: rssflow-websub-env
          resources:
            requests:
              cpu: 50m
              memory: 256Mi

    fetch:
      containers:
        app:
          <<: *controller
          image:
            repository: ghcr.io/m00nwtchr/rssflow-fetch
            tag: master@sha256:5d4c984dcab2b6cae9596be847b505d76398b56f25c8bf68ff269d9e09d6a6da

    filter:
      containers:
        app:
          <<: *controller
          image:
            repository: ghcr.io/m00nwtchr/rssflow-filter
            tag: master@sha256:e38f516865140c2f5f0f02b558c6b0426bdea6682786bcef05c95d483fc05e31

    replace:
      containers:
        app:
          <<: *controller
          image:
            repository: ghcr.io/m00nwtchr/rssflow-replace
            tag: master@sha256:cae486608f47ef4d844420f980771850b94b5ef6463706a6809cb1e1350be775


    retrieve:
      containers:
        app:
          <<: *controller
          image:
            repository: ghcr.io/m00nwtchr/rssflow-retrieve
            tag: master@sha256:25e6a4ffd2abccd7347ca9a6fb75a13d19ff04cc201a438a105d6c6551ddc85b

    sanitize:
      containers:
        app:
          <<: *controller
          image:
            repository: ghcr.io/m00nwtchr/rssflow-sanitize
            tag: master@sha256:9ba08a073d101568883aa0aa193925f26f7fc3e18634e5b31c2f0efbc9a6ac4d


  service:
    valkey:
      controller: valkey
      ports:
        main:
          port: 6379

    rssflow:
      controller: rssflow
      ports:
        http:
          port: 80
          targetPort: 3434
        grpc:
          port: 50051

    websub:
      controller: websub
      ports:
        http:
          port: 80
          targetPort: 3435
        grpc:
          port: 50051

    fetch:
      controller: fetch
      ports:
        grpc:
          port: 50051

    filter:
      controller: filter
      ports:
        grpc:
          port: 50051

    replace:
      controller: replace
      ports:
        grpc:
          port: 50051

    retrieve:
      controller: retrieve
      ports:
        grpc:
          port: 50051

  ingress:
    websub:
      enabled: true
      hosts:
        - host: "rssflow.m00nlit.dev"
          paths:
            - path: /websub/
              service:
                identifier: websub
                port: http

  persistence:
    data:
      size: 1Gi
      accessMode: ReadWriteOnce
      annotations:
        argocd.argoproj.io/sync-options: Delete=false
