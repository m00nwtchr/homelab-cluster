app-template:
  controllers:
    valkey:
      containers:
        app:
          image:
            repository: docker.io/valkey/valkey
            tag: 8.1.1-alpine@sha256:f43639a6811342b5db26475f3463d4d1950d07bf05542d9483159a44be1fe62f

    rssflow:
      containers:
        app:
          image:
            repository: ghcr.io/m00nwtchr/rssflow
            tag: master@sha256:0a10d424892e4d6a1c23f4950be75db62edee5f2ad565cd26a63d351ad261f7f
          env:
            RUST_LOG: "info"
            REDIS_URL: redis://rssflow-valkey
          envFrom:
            - secretRef:
                name: rssflow-env
          resources:
            requests:
              cpu: 50m
              memory: 256Mi

    websub:
      containers:
        app: &controller
          image:
            repository: ghcr.io/m00nwtchr/rssflow-websub
            tag: master@sha256:7196280a1e036f2276e8dcfa467955e0719e42acbc5c9492a7fe7176411c63e4
          env:
            RUST_LOG: "info"
            REDIS_URL: redis://rssflow-valkey
          envFrom:
            - secretRef:
                name: rssflow-websub-env
          resources:
            requests:
              cpu: 50m
              memory: 256Mi

    fetch:
      containers:
        app:
          <<: *controller
          image:
            repository: ghcr.io/m00nwtchr/rssflow-fetch
            tag: master@sha256:4b928487fc70e2f79c185d8bb0b78f3a7e03510bd81f6d4d8924144025593929

    filter:
      containers:
        app:
          <<: *controller
          image:
            repository: ghcr.io/m00nwtchr/rssflow-filter
            tag: master@sha256:e38f516865140c2f5f0f02b558c6b0426bdea6682786bcef05c95d483fc05e31

    replace:
      containers:
        app:
          <<: *controller
          image:
            repository: ghcr.io/m00nwtchr/rssflow-replace
            tag: master@sha256:cae486608f47ef4d844420f980771850b94b5ef6463706a6809cb1e1350be775


    retrieve:
      containers:
        app:
          <<: *controller
          image:
            repository: ghcr.io/m00nwtchr/rssflow-retrieve
            tag: master@sha256:6aa1349412dd415c52eb59be11967654cd106f9a459105320f962cdb7f88b083

    sanitize:
      containers:
        app:
          <<: *controller
          image:
            repository: ghcr.io/m00nwtchr/rssflow-sanitize
            tag: master@sha256:76af9bbe4304f2fed847fdf9056460531f2d5323682d21903efd2a8ff6e77d3f


  service:
    valkey:
      controller: valkey
      ports:
        main:
          port: 6379

    rssflow:
      controller: rssflow
      ports:
        http:
          port: 80
          targetPort: 3434
        grpc:
          port: 50051

    websub:
      controller: websub
      ports:
        http:
          port: 80
          targetPort: 3435
        grpc:
          port: 50051

    fetch:
      controller: fetch
      ports:
        grpc:
          port: 50051

    filter:
      controller: filter
      ports:
        grpc:
          port: 50051

    replace:
      controller: replace
      ports:
        grpc:
          port: 50051

    retrieve:
      controller: retrieve
      ports:
        grpc:
          port: 50051

  ingress:
    websub:
      enabled: true
      hosts:
        - host: "rssflow.m00nlit.dev"
          paths:
            - path: /websub/
              service:
                identifier: websub
                port: http

  persistence:
    data:
      size: 1Gi
      accessMode: ReadWriteOnce
      annotations:
        argocd.argoproj.io/sync-options: Delete=false
