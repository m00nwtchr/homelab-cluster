apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: couchdb
  namespace: argocd
  finalizers:
    - resources-finalizer.argocd.argoproj.io
spec:
  project: kubernetes
  source:
    repoURL: https://apache.github.io/couchdb-helm
    chart: couchdb
    targetRevision: 4.5.6
    helm:
      valuesObject:
        autoSetup:
          enabled: true
        couchdbConfig:
          couchdb:
            max_document_size: 50000000
            uuid: ffc6b0f4-a06a-4f93-85b0-68ab3dac98ce
          chttpd:
            bind_address: any
            require_valid_user: true
            max_http_request_size: 4294967296
          chttpd_auth:
            require_valid_user: true
            max_http_request_size: /e=_/_utils/session.html
          httpd:
            WWW-Authenticate: "Basic realm=\"couchdb\""
            enable_cors: true
          cors:
            origins: "app://obsidian.md,capacitor://localhost,http://localhost"
            credentials: true
            headers: "accept, authorization, content-type, origin, referer"
            methods: "GET, PUT, POST, HEAD, DELETE"
            max_age: 3600
  persistentVolume:
    enabled: true
  ingress:
    enabled: true
    hosts:
      - obsidian-livesync.m00nlit.dev
      - obsidian-livesync.svc.m00nlit.dev
    path: /

  destination:
    name: in-cluster
    namespace: default
  syncPolicy:
    automated:
      prune: false
      selfHeal: true
{{/*    syncOptions:*/}}
{{/*      - CreateNamespace=true*/}}