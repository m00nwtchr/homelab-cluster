apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: vaultwarden
  namespace: argocd
  finalizers:
    - resources-finalizer.argocd.argoproj.io
spec:
  project: kubernetes
  source:
    repoURL: https://guerzon.github.io/vaultwarden
    chart: vaultwarden
    targetRevision: 0.31.8
    helm:
      valuesObject:
        # TODO: Convert to app-template
        domain: "https://vaultwarden.{{ .Values.domain }}"

        rocket:
          address: "::"

        ingress:
          enabled: true
          class: ""
          nginxIngressAnnotations: false
          hostname: "vaultwarden.{{ .Values.domain }}"

        storage:
          data:
            name: "vaultwarden-data"
            size: "15Gi"
            class: ""
            path: "/data"
            keepPvc: true
            accessMode: "ReadWriteOnce"

  destination:
    name: in-cluster
    namespace: default
  syncPolicy:
    automated:
      prune: false
      selfHeal: true
{{/*    syncOptions:*/}}
{{/*      - CreateNamespace=true*/}}