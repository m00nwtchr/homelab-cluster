---
# yaml-language-server: $schema=https://taskfile.dev/schema.json
version: "3"

tasks:
  create-oidc:
    desc: Create OIDC app [APP=required]
    vars:
      DOMAIN: m00nlit.dev
    requires:
      vars:
        - APP
    preconditions:
      - which kanidm
    cmds:
      - kanidm system oauth2 create {{.APP}} {{.APP}} https://{{.APP}}.{{.DOMAIN}}
      - kanidm system oauth2 update-scope-map {{.APP}} admins openid profile
      - kanidm system oauth2 add-redirect-url {{.APP}} https://{{.APP}}.{{.DOMAIN}}/oauth2/callback
